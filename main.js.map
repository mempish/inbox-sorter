{
  "version": 3,
  "sources": ["main.ts"],
  "sourcesContent": ["import {\n  App,\n  Notice,\n  Plugin,\n  PluginSettingTab,\n  Setting,\n  TFile,\n  normalizePath,\n} from \"obsidian\";\n\ntype TagInputMode = \"prepend-hash\" | \"raw\";\n\ninterface InboxSorterSettings {\n  inboxFolder: string;\n  processedFolder: string;\n  defaultTags: string;\n  tagInputMode: TagInputMode;\n  addTimestampTag: boolean;\n  timestampTagFormat: string;\n}\n\nconst DEFAULT_SETTINGS: InboxSorterSettings = {\n  inboxFolder: \"Inbox\",\n  processedFolder: \"Notes\",\n  defaultTags: \"inbox\",\n  tagInputMode: \"prepend-hash\",\n  addTimestampTag: false,\n  timestampTagFormat: \"yyyy-MM-dd\",\n};\n\nexport default class InboxSorterPlugin extends Plugin {\n  settings!: InboxSorterSettings;\n\n  async onload() {\n    await this.loadSettings();\n\n    this.addCommand({\n      id: \"inbox-sorter-tag-active\",\n      name: \"Add default tags to active note\",\n      checkCallback: (checking: boolean) => {\n        const file = this.app.workspace.getActiveFile();\n        if (!file) return false;\n        if (!checking) {\n          void this.addTagsToFile(file, this.getDefaultTags());\n        }\n        return true;\n      },\n    });\n\n    this.addCommand({\n      id: \"inbox-sorter-tag-and-file\",\n      name: \"Tag and file active note\",\n      checkCallback: (checking: boolean) => {\n        const file = this.app.workspace.getActiveFile();\n        if (!file) return false;\n        if (!checking) {\n          void this.tagAndFile(file);\n        }\n        return true;\n      },\n    });\n\n    this.addCommand({\n      id: \"inbox-sorter-add-tags-prompt\",\n      name: \"Add tags to active note (prompt)\",\n      checkCallback: (checking: boolean) => {\n        const file = this.app.workspace.getActiveFile();\n        if (!file) return false;\n        if (!checking) {\n          void this.addTagsFromPrompt(file);\n        }\n        return true;\n      },\n    });\n\n    this.addSettingTab(new InboxSorterSettingTab(this.app, this));\n  }\n\n  async addTagsFromPrompt(file: TFile) {\n    const value = window.prompt(\"Enter tags (comma-separated)\");\n    if (!value) return;\n    const tags = this.normalizeTags(value.split(\",\"));\n    await this.addTagsToFile(file, tags);\n  }\n\n  async tagAndFile(file: TFile) {\n    const tags = this.getDefaultTags();\n    await this.addTagsToFile(file, tags);\n    await this.moveFileOutOfInbox(file);\n  }\n\n  async addTagsToFile(file: TFile, tags: string[]) {\n    if (tags.length === 0) {\n      new Notice(\"No tags provided\");\n      return;\n    }\n\n    const fileManager = this.app.fileManager;\n    await fileManager.processFrontMatter(file, (frontmatter) => {\n      const existing = this.extractTags(frontmatter.tags);\n      const merged = this.mergeTags(existing, tags);\n\n      if (this.settings.addTimestampTag) {\n        const stamp = this.formatDateTag(this.settings.timestampTagFormat);\n        merged.push(this.normalizeTag(stamp));\n      }\n\n      frontmatter.tags = merged;\n    });\n\n    new Notice(`Added tags to ${file.basename}`);\n  }\n\n  async moveFileOutOfInbox(file: TFile) {\n    const inboxPath = normalizePath(this.settings.inboxFolder);\n    const targetFolder = normalizePath(this.settings.processedFolder);\n\n    if (!file.path.startsWith(`${inboxPath}/`) && file.path !== inboxPath) {\n      new Notice(\"Active note is not in the inbox folder\");\n      return;\n    }\n\n    await ensureFolderExists(this.app, targetFolder);\n    const newPath = normalizePath(`${targetFolder}/${file.name}`);\n    await this.app.vault.rename(file, newPath);\n    new Notice(`Moved to ${targetFolder}`);\n  }\n\n  getDefaultTags(): string[] {\n    return this.normalizeTags(this.settings.defaultTags.split(\",\"));\n  }\n\n  normalizeTags(rawTags: string[]): string[] {\n    return rawTags\n      .map((tag) => tag.trim())\n      .filter((tag) => tag.length > 0)\n      .map((tag) => this.normalizeTag(tag));\n  }\n\n  normalizeTag(tag: string): string {\n    if (this.settings.tagInputMode === \"raw\") {\n      return tag.replace(/^#/, \"\");\n    }\n    return tag.startsWith(\"#\") ? tag.slice(1) : tag;\n  }\n\n  extractTags(value: unknown): string[] {\n    if (!value) return [];\n    if (Array.isArray(value)) {\n      return value.map((tag) => String(tag));\n    }\n    if (typeof value === \"string\") {\n      return value.split(\",\").map((tag) => tag.trim());\n    }\n    return [];\n  }\n\n  mergeTags(existing: string[], incoming: string[]): string[] {\n    const set = new Set(existing.map((tag) => this.normalizeTag(tag)));\n    for (const tag of incoming) {\n      set.add(this.normalizeTag(tag));\n    }\n    return Array.from(set.values());\n  }\n\n  formatDateTag(format: string): string {\n    const now = new Date();\n    const pad = (value: number) => String(value).padStart(2, \"0\");\n    const replacements: Record<string, string> = {\n      yyyy: String(now.getFullYear()),\n      MM: pad(now.getMonth() + 1),\n      dd: pad(now.getDate()),\n      HH: pad(now.getHours()),\n      mm: pad(now.getMinutes()),\n    };\n\n    let result = format;\n    for (const [token, replacement] of Object.entries(replacements)) {\n      result = result.replaceAll(token, replacement);\n    }\n    return result;\n  }\n\n  async loadSettings() {\n    this.settings = Object.assign({}, DEFAULT_SETTINGS, await this.loadData());\n  }\n\n  async saveSettings() {\n    await this.saveData(this.settings);\n  }\n}\n\nclass InboxSorterSettingTab extends PluginSettingTab {\n  plugin: InboxSorterPlugin;\n\n  constructor(app: App, plugin: InboxSorterPlugin) {\n    super(app, plugin);\n    this.plugin = plugin;\n  }\n\n  display(): void {\n    const { containerEl } = this;\n\n    containerEl.empty();\n    containerEl.createEl(\"h2\", { text: \"Inbox Sorter Settings\" });\n\n    new Setting(containerEl)\n      .setName(\"Inbox folder\")\n      .setDesc(\"Folder containing notes to process\")\n      .addText((text) =>\n        text\n          .setPlaceholder(\"Inbox\")\n          .setValue(this.plugin.settings.inboxFolder)\n          .onChange(async (value) => {\n            this.plugin.settings.inboxFolder = value.trim() || \"Inbox\";\n            await this.plugin.saveSettings();\n          })\n      );\n\n    new Setting(containerEl)\n      .setName(\"Processed folder\")\n      .setDesc(\"Destination folder for filed notes\")\n      .addText((text) =>\n        text\n          .setPlaceholder(\"Notes\")\n          .setValue(this.plugin.settings.processedFolder)\n          .onChange(async (value) => {\n            this.plugin.settings.processedFolder = value.trim() || \"Notes\";\n            await this.plugin.saveSettings();\n          })\n      );\n\n    new Setting(containerEl)\n      .setName(\"Default tags\")\n      .setDesc(\"Comma-separated tags to apply when filing notes\")\n      .addTextArea((text) =>\n        text\n          .setPlaceholder(\"inbox, to-process\")\n          .setValue(this.plugin.settings.defaultTags)\n          .onChange(async (value) => {\n            this.plugin.settings.defaultTags = value;\n            await this.plugin.saveSettings();\n          })\n      );\n\n    new Setting(containerEl)\n      .setName(\"Tag input mode\")\n      .setDesc(\"How tag input is interpreted\")\n      .addDropdown((dropdown) =>\n        dropdown\n          .addOption(\"prepend-hash\", \"Strip leading #\")\n          .addOption(\"raw\", \"Keep raw tag text\")\n          .setValue(this.plugin.settings.tagInputMode)\n          .onChange(async (value: TagInputMode) => {\n            this.plugin.settings.tagInputMode = value;\n            await this.plugin.saveSettings();\n          })\n      );\n\n    new Setting(containerEl)\n      .setName(\"Add timestamp tag\")\n      .setDesc(\"Optionally add a timestamp tag when filing notes\")\n      .addToggle((toggle) =>\n        toggle\n          .setValue(this.plugin.settings.addTimestampTag)\n          .onChange(async (value) => {\n            this.plugin.settings.addTimestampTag = value;\n            await this.plugin.saveSettings();\n          })\n      );\n\n    new Setting(containerEl)\n      .setName(\"Timestamp tag format\")\n      .setDesc(\"Use tokens: yyyy, MM, dd, HH, mm\")\n      .addText((text) =>\n        text\n          .setPlaceholder(\"yyyy-MM-dd\")\n          .setValue(this.plugin.settings.timestampTagFormat)\n          .onChange(async (value) => {\n            this.plugin.settings.timestampTagFormat = value.trim() || \"yyyy-MM-dd\";\n            await this.plugin.saveSettings();\n          })\n      );\n\n    containerEl.createEl(\"p\", {\n      text: \"Commands are available in the command palette.\",\n      cls: \"inbox-sorter-hint\",\n    });\n  }\n}\n\nasync function ensureFolderExists(app: App, path: string) {\n  const normalized = normalizePath(path);\n  if (app.vault.getAbstractFileByPath(normalized)) return;\n  await app.vault.createFolder(normalized);\n}\n"],
  "mappings": "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",
  "names": []
}
